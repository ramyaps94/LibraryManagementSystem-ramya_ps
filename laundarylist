main function should be optimized and tested using mockito --done
